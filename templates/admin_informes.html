{% extends "admin_base.html" %}

{% block title %}Gestión de Informes - Panel Admin{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-file-alt me-2"></i>Gestión de Informes</h2>
    <a href="{{ url_for('admin.nuevo_informe') }}" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Nuevo Informe
    </a>
</div>
    
    {% if informes %}
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Título</th>
                                        <th>Usuario</th>
                                        <th>Tipo</th>
                                        <th>Cita Relacionada</th>
                                        <th>Docente</th>
                                        <th>Tipo de Sesión</th>
                                        <th>Estado</th>
                                        <th>Fecha Creación</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for informe in informes %}
                                    <tr>
                                        <td>{{ informe.titulo }}</td>
                                        <td>{{ informe.usuario.nombre_completo or informe.usuario.username }}</td>
                                        <td>
                                            {% if informe.tipo == 'docente' %}
                                                <span class="badge bg-warning">
                                                    <i class="fas fa-paper-plane me-1"></i>Reporte Docente
                                                </span>
                                            {% else %}
                                                <span class="badge bg-primary">
                                                    <i class="fas fa-file-alt me-1"></i>Informe Admin
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if informe.cita %}
                                                <span class="badge bg-success" title="Cita #{{ informe.cita.id }} - {{ informe.cita.fecha.strftime('%d/%m/%Y') }}">
                                                    <i class="fas fa-calendar-check me-1"></i>Cita #{{ informe.cita.id }}
                                                </span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if informe.tipo == 'docente' and informe.docente_remitente %}
                                                <span class="badge bg-info" title="Docente que envió el reporte">
                                                    <i class="fas fa-user-tie me-1"></i>{{ informe.docente_remitente.nombre_completo or informe.docente_remitente.username }}
                                                </span>
                                            {% elif informe.docente %}
                                                <span class="badge bg-info">{{ informe.docente.nombre_completo or informe.docente.username }}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Todos los docentes</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if informe.tipo_sesion %}
                                                <span class="badge bg-primary">{{ informe.tipo_sesion }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-{{ 'success' if informe.estado == 'enviado' else 'warning' if informe.estado == 'pendiente' else 'secondary' }}">
                                                {{ informe.estado.title() }}
                                            </span>
                                        </td>
                                        <td>{{ informe.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ url_for('admin.imprimir_informe', informe_id=informe.id) }}" class="btn btn-outline-info" title="Ver">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                {% if informe.tipo == 'docente' %}
                                                <a href="{{ url_for('admin.agregar_archivos_informe', informe_id=informe.id) }}" class="btn btn-outline-primary" title="Agregar Archivos">
                                                    <i class="fas fa-paperclip"></i>
                                                </a>
                                                {% endif %}
                                                {% if informe.estado == 'pendiente' and informe.tipo == 'admin' %}
                                                <form method="POST" action="{{ url_for('admin.enviar_informe', informe_id=informe.id) }}" class="d-inline">
                                                    <button type="submit" class="btn btn-outline-success" title="Enviar">
                                                        <i class="fas fa-paper-plane"></i>
                                                    </button>
                                                </form>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card text-center">
                    <div class="card-body py-5">
                        <i class="fas fa-file-alt text-muted mb-3" style="font-size: 4rem;"></i>
                        <h4 class="text-muted">No hay informes registrados</h4>
                        <p class="text-muted">Crea un nuevo informe para comenzar</p>
                        <a href="{{ url_for('admin.nuevo_informe') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Crear Informe
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

